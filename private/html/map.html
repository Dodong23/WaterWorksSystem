<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Client Location Map</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
    }

    #map {
        width: 100%;
        height: 100%;
    }

    .leaflet-popup-content input {
        width: 95%;
        padding: 5px;
        margin-top: 5px;
    }

    .leaflet-popup-content button {
        margin-top: 6px;
        padding: 6px 10px;
        border: none;
        background: #0d6efd;
        color: white;
        border-radius: 4px;
        cursor: pointer;
    }

    .leaflet-popup-content button.delete {
        background: #dc3545;
    }
</style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// Default location (Philippines)
const map = L.map('map').setView([8.516154, 123.091722], 100); // 8.516154

// Map tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap'
}).addTo(map);


// ===== STORAGE =====
let savedPins = JSON.parse(localStorage.getItem("savedPins") || "[]");


// ===== LOAD SAVED PINS =====
savedPins.forEach(pin => {
    createMarker(pin.lat, pin.lng, pin.name, false);
});


// ===== CLICK TO ADD PIN =====
map.on('click', function(e) {
    const lat = e.latlng.lat;
    const lng = e.latlng.lng;

    const name = prompt("Enter name for this location:");

    if(!name) return;

    savedPins.push({lat, lng, name});
    localStorage.setItem("savedPins", JSON.stringify(savedPins));

    createMarker(lat, lng, name, true);
});


// ===== CREATE MARKER =====
function createMarker(lat, lng, name, openPopup = false){

    const marker = L.marker([lat, lng]).addTo(map);

    const popupContent = `
        <b>${name}</b><br>
        Lat: ${lat.toFixed(6)}<br>
        Lng: ${lng.toFixed(6)}<br>
        <button class="delete">Delete</button>
    `;

    marker.bindPopup(popupContent);

    marker.on('popupopen', function(e){
        const btn = document.querySelector(".delete");
        btn.onclick = function(){
            map.removeLayer(marker);

            savedPins = savedPins.filter(p =>
                !(p.lat === lat && p.lng === lng && p.name === name)
            );

            localStorage.setItem("savedPins", JSON.stringify(savedPins));
        };
    });

    if(openPopup) marker.openPopup();
}

</script>

</body>
</html>
